<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Blog - Gajendra Mandal</title>
  <style>
    /* Styling follows the same visual language as your projects/publications pages */
    *{box-sizing:border-box;margin:0;padding:0}
    html,body{height:100%}
    body{
      font-family:'Inter',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;
      line-height:1.6;color:#222;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);min-height:100vh;
    }

    .container{max-width:1200px;margin:0 auto;padding:0 20px}
    header{background:rgba(30,34,45,0.85);backdrop-filter:blur(8px);box-shadow:0 2px 16px rgba(30,34,45,0.12);position:sticky;top:0;z-index:100}
    nav{display:flex;justify-content:space-between;align-items:center;padding:1rem 0}
    .logo{font-size:1.4rem;font-weight:700;color:#fff;text-decoration:none}
    .nav-links{display:flex;gap:1.2rem;list-style:none}
    .nav-links a{color:#fff;text-decoration:none;font-weight:500;transition:all .3s ease}
    .nav-links a:hover{color:#ffd700;transform:translateY(-2px)}

    .floating-elements{position:fixed;top:0;left:0;width:100%;height:100%;pointer-events:none;z-index:-1}
    .floating-element{position:absolute;background:rgba(255,255,255,0.08);border-radius:50%;animation:float 6s ease-in-out infinite}
    @keyframes float{0%,100%{transform:translateY(0) rotate(0)}50%{transform:translateY(-20px) rotate(180deg)}}

    .blog-section{background:rgba(255,255,255,0.96);border-radius:18px;padding:2.2rem;margin:2rem 0;box-shadow:0 20px 40px rgba(0,0,0,0.08);border:1px solid rgba(255,255,255,0.2)}
    .blog-section h2{font-size:2rem;text-align:center;margin-bottom:0.4rem;background:linear-gradient(135deg,#667eea,#764ba2);-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:700}
    .blog-sub{color:#666;text-align:center;margin-bottom:1.5rem}

    .blog-stats{display:flex;justify-content:center;gap:2rem;margin-bottom:2rem;flex-wrap:wrap}
    .stat-item{text-align:center;padding:1rem;background:rgba(102,126,234,0.05);border-radius:15px;min-width:120px}
    .stat-number{font-size:1.8rem;font-weight:bold;color:#667eea;display:block}
    .stat-label{font-size:0.9rem;color:#666;margin-top:0.3rem}

    .controls{display:flex;justify-content:space-between;align-items:center;gap:1rem;flex-wrap:wrap;margin-bottom:1.25rem}
    .filters{display:flex;gap:0.6rem;flex-wrap:wrap}
    .filter-btn{padding:0.5rem 0.9rem;border:2px solid #667eea;background:transparent;color:#667eea;border-radius:18px;font-weight:600;cursor:pointer;transition:all .25s;font-size:0.9rem}
    .filter-btn.active,.filter-btn:hover{background:#667eea;color:#fff;transform:translateY(-2px)}

    .search{display:flex;gap:0.5rem;align-items:center}
    .search input{padding:0.55rem 0.75rem;border-radius:10px;border:1px solid rgba(0,0,0,0.08);min-width:220px;font-size:0.9rem}
    .search input:focus{outline:none;border-color:#667eea;box-shadow:0 0 0 3px rgba(102,126,234,0.1)}

    .blog-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(340px,1fr));gap:1.2rem;margin-top:1rem}

    .post-card{background:#fff;border-radius:12px;padding:1rem;border:1px solid rgba(102,126,234,0.08);box-shadow:0 8px 24px rgba(102,126,234,0.12);position:relative;overflow:hidden;cursor:pointer;transition:all .3s}
    .post-card:hover{transform:translateY(-6px);box-shadow:0 18px 40px rgba(102,126,234,0.18)}
    .post-card.external{border-left:4px solid #f39c12}
    .post-card.external:after{content:'üîó';position:absolute;top:0.8rem;right:0.8rem;font-size:1rem;opacity:0.6}

    .post-meta{display:flex;justify-content:space-between;align-items:center;margin-bottom:0.6rem}
    .post-title{font-size:1.05rem;font-weight:700;color:#222;margin-bottom:0.4rem;line-height:1.3}
    .post-excerpt{color:#444;font-size:0.95rem;line-height:1.45;max-height:5.2rem;overflow:hidden;margin-bottom:0.6rem}

    .tags{display:flex;gap:0.4rem;flex-wrap:wrap;margin-bottom:0.8rem}
    .tag{background:rgba(102,126,234,0.08);color:#667eea;padding:0.25rem 0.55rem;border-radius:10px;font-weight:600;font-size:0.8rem}

    .post-footer{display:flex;justify-content:space-between;align-items:center;margin-top:0.8rem;padding-top:0.8rem;border-top:1px solid rgba(102,126,234,0.1)}
    .read-time{background:rgba(102,126,234,0.1);padding:0.2rem 0.6rem;border-radius:10px;font-size:0.8rem;color:#667eea;font-weight:600}
    .read-btn{padding:0.45rem 0.75rem;border-radius:14px;background:#667eea;color:#fff;text-decoration:none;font-weight:700;font-size:0.85rem;transition:all .3s ease;cursor:pointer;border:none}
    .read-btn:hover{background:#5a6fd8;transform:translateY(-1px)}
    .read-btn.external{background:#f39c12}
    .read-btn.external:hover{background:#e67e22}

    /* overlay for full post */
    .post-overlay{position:fixed;inset:0;background:rgba(10,12,20,0.6);display:flex;align-items:flex-start;justify-content:center;padding:40px 20px;z-index:120;overflow:auto;backdrop-filter:blur(5px)}
    .overlay-card{background:#fff;border-radius:14px;max-width:900px;width:100%;padding:1.6rem;box-shadow:0 30px 70px rgba(0,0,0,0.4);position:relative;animation:slideIn .3s ease}
    .overlay-close{position:absolute;right:12px;top:12px;border:none;background:rgba(102,126,234,0.1);font-size:1.2rem;cursor:pointer;width:32px;height:32px;border-radius:50%;display:flex;align-items:center;justify-content:center;color:#667eea;transition:all .2s}
    .overlay-close:hover{background:#667eea;color:#fff}
    .overlay-title{font-size:1.4rem;font-weight:800;margin-bottom:0.4rem;color:#222}
    .overlay-meta{color:#666;margin-bottom:1rem;display:flex;gap:1rem;align-items:center;flex-wrap:wrap}
    .overlay-content{color:#222;line-height:1.7}
    .overlay-content h1,.overlay-content h2,.overlay-content h3{margin:1.5rem 0 1rem 0;color:#333;font-weight:700}
    .overlay-content h1{font-size:1.8rem}
    .overlay-content h2{font-size:1.5rem}
    .overlay-content h3{font-size:1.3rem}
    .overlay-content h4{margin:1.2rem 0 0.8rem 0;color:#444;font-size:1.1rem;font-weight:600}
    .overlay-content p{margin-bottom:1rem;text-align:justify}
    .overlay-content ul,.overlay-content ol{margin:1rem 0;padding-left:1.5rem}
    .overlay-content li{margin-bottom:0.5rem;line-height:1.6}
    .overlay-content code{background:rgba(102,126,234,0.1);padding:0.2rem 0.4rem;border-radius:4px;font-family:monospace;font-size:0.9rem}
    .overlay-content pre{background:#f8f9fa;padding:1rem;border-radius:8px;overflow-x:auto;margin:1rem 0}
    .overlay-content pre code{background:none;padding:0}
    .overlay-content blockquote{border-left:4px solid #667eea;padding-left:1rem;margin:1rem 0;font-style:italic;color:#555}
    .overlay-content img{max-width:100%;height:auto;border-radius:8px;margin:1rem 0}
    .overlay-content table{width:100%;border-collapse:collapse;margin:1rem 0}
    .overlay-content th,.overlay-content td{padding:0.5rem;border:1px solid #ddd;text-align:left}
    .overlay-content th{background:#f8f9fa}

    @keyframes slideIn{from{opacity:0;transform:translateY(30px)}to{opacity:1;transform:translateY(0)}}

    .external-note{margin-top:1rem;padding:0.6rem;border-radius:10px;background:rgba(243,156,18,0.1);font-weight:600;color:#e67e22}

    .post-card{opacity:0;transform:translateY(24px);transition:all .45s}
    .post-card.animate{opacity:1;transform:translateY(0)}
    .post-card.hidden{display:none!important}

    .empty-state{text-align:center;padding:3rem 2rem;color:#666}
    .empty-state.show{display:block}
    .empty-state{display:none}
    .empty-icon{font-size:3rem;margin-bottom:1rem;opacity:0.5}

    .loading{text-align:center;padding:2rem;color:#667eea}

    @media(max-width:768px){
      .nav-links{display:none}
      .overlay-card{padding:1rem;margin:10px}
      .blog-section{padding:1.5rem;margin:1rem 0}
      .blog-section h2{font-size:1.8rem}
      .controls{flex-direction:column;align-items:stretch}
      .search input{min-width:auto}
      .blog-grid{grid-template-columns:1fr}
      .blog-stats{gap:1rem}
      .stat-item{min-width:100px;padding:0.8rem}
      .post-footer{flex-direction:column;gap:0.5rem;align-items:stretch}
      .read-btn{text-align:center}
    }
  </style>
</head>
<body>
  <div class="floating-elements">
    <div class="floating-element" style="width:60px;height:60px;top:8%;left:6%;animation-delay:0s"></div>
    <div class="floating-element" style="width:80px;height:80px;top:18%;right:12%;animation-delay:2s"></div>
    <div class="floating-element" style="width:40px;height:40px;bottom:28%;left:18%;animation-delay:4s"></div>
    <div class="floating-element" style="width:100px;height:100px;bottom:8%;right:8%;animation-delay:1s"></div>
  </div>

  <header>
    <nav class="container">
      <a href="index.html#home" class="logo">Gajendra Mandal</a>
      <ul class="nav-links">
        <li><a href="index.html#home">Home</a></li>
        <li><a href="skill.html">Skills</a></li>
        <li><a href="projects.html">Projects</a></li>
        <li><a href="publications.html">Publications</a></li>
        <li><a href="blogposts.html">Blogposts</a></li>
        <li><a href="gallery.html">Gallery</a></li>
      </ul>
    </nav>
  </header>

  <main class="container">
    <section class="blog-section">
      <h2>Tech & ML Blog</h2>
      <p class="blog-sub">Insights, tutorials, and discoveries in machine learning, AI, and software engineering ‚Äî sharing knowledge from research to practice.</p>

      <!-- Blog Statistics -->
      <div class="blog-stats">
        <div class="stat-item">
          <span class="stat-number" id="total-posts">0</span>
          <div class="stat-label">Total Posts</div>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="total-categories">0</span>
          <div class="stat-label">Categories</div>
        </div>
        <div class="stat-item">
          <span class="stat-number" id="total-read-time">0</span>
          <div class="stat-label">Min Read</div>
        </div>
      </div>

      <div class="controls">
        <div class="filters" id="filter-buttons">
          <button class="filter-btn active" data-filter="all" id="filter-all">All</button>
          <!-- Dynamic filter buttons will be added here -->
        </div>
        <div class="search">
          <input id="blog-search" type="search" placeholder="Search posts..." />
        </div>
      </div>

      <div id="blogGrid" class="blog-grid">
        <div class="loading">Loading blog posts...</div>
      </div>

      <!-- Empty State -->
      <div class="empty-state" id="empty-state">
        <div class="empty-icon">üìù</div>
        <h3>No blog posts found</h3>
        <p>Try adjusting your search or filter criteria.</p>
      </div>
    </section>
  </main>

  <!-- overlay for full post reading -->
  <div id="postOverlay" class="post-overlay" style="display:none">
    <div class="overlay-card">
      <button id="overlayClose" class="overlay-close" aria-label="Close">‚úï</button>
      <div id="overlayTitle" class="overlay-title"></div>
      <div id="overlayMeta" class="overlay-meta"></div>
      <div id="overlayContent" class="overlay-content"></div>
      <div id="overlayExternal" class="external-note" style="display:none"></div>
    </div>
  </div>

  <script>
    /*
      JSON-driven blog (same as your gallery):
      Place a file at: data/blog.json
      Example (supports markdown files AND external links):

      [
        {
          "title": "YOLOv8 Nostrils: From Detection to Breathing Signal",
          "category": "cv",
          "tags": ["yolo", "thermal", "respiration"],
          "date": "2025-08-20",
          "markdownFile": "yolo-nostrils.md",   // loads from blog/yolo-nostrils.md
          "excerpt": "Validating nostril detection and respiration rate extraction with thermal video."
        },
        {
          "title": "My ApneaEye Writeup on Medium",
          "category": "research",
          "tags": ["apnea", "medium"],
          "date": "2025-08-12",
          "externalUrl": "https://medium.com/@gajendra/...",
          "excerpt": "Overview of ApneaEye pipeline and lessons learned."
        },
        {
          "title": "Dummy Inline Post",
          "category": "general",
          "tags": ["update"],
          "date": "2025-08-01",
          "content": "# Update\\nSmall progress log with **bold** text and a list:\\n* point A\\n* point B"
        }
      ]
    */

    // ---------- Global variables ----------
    let blogPosts = [];
    let filteredPosts = [];
    let currentFilter = 'all';
    let allCategories = new Set();

    // Inline fallback (used only if data/blog.json fails)
    const FALLBACK_POSTS = [
      {
        title: "Welcome to the Blog",
        category: "general",
        tags: ["intro"],
        date: new Date().toISOString().split('T')[0],
        content: "# Hello!\\nThis is a *fallback* demo post rendered from **inline JSON**.\\n\\n```js\\nconsole.log('It works!')\\n```",
        excerpt: "This is a fallback demo post rendered from inline JSON."
      },
      {
        title: "External Medium Demo",
        category: "updates",
        tags: ["external"],
        date: "2025-08-15",
        externalUrl: "https://example.com",
        excerpt: "This is an external article. Click to open the original."
      }
    ];

    // ---------- Utilities ----------
    function escapeHtml(s){return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));}
    function parseDateValue(d){const t=Date.parse(d);return isNaN(t)?0:t;}
    function formatDate(dateStr){
      if(!dateStr) return 'Recent';
      const date=new Date(dateStr);
      return date.toLocaleDateString('en-US',{year:'numeric',month:'short',day:'numeric'});
    }
    function calculateReadingTime(content){
      if(!content) return 1;
      const plain=content.replace(/<[^>]*>/g,' ').replace(/\s+/g,' ').trim();
      const words=plain.split(' ').filter(w=>w.length>0).length;
      return Math.max(1,Math.ceil(words/200));
    }
    function generateExcerpt(content,maxLength=150){
      if(!content) return '';
      const plain=content.replace(/<[^>]*>/g,' ').replace(/\s+/g,' ').trim();
      if(plain.length<=maxLength) return plain;
      const truncated=plain.substring(0,maxLength);
      const lastSentence=truncated.lastIndexOf('.');
      const lastSpace=truncated.lastIndexOf(' ');
      const cutPoint=lastSentence>maxLength-50?lastSentence+1:lastSpace;
      return plain.substring(0,cutPoint).trim()+'...';
    }

    // ---------- Minimal Markdown parser ----------
    function parseMarkdown(md){
  if(!md) return '';

  // 1) code blocks (triple backticks) ‚Äî escape inside
  let html = md.replace(/```([\s\S]*?)```/g, (m, code) => {
    return `<pre><code>${escapeHtml(code)}</code></pre>`;
  });

  // 2) inline code
  html = html.replace(/`([^`]+)`/g, (m, code) => `<code>${escapeHtml(code)}</code>`);

  // 3) headings
  html = html
    .replace(/^### (.*)$/gm, '<h3>$1</h3>')
    .replace(/^## (.*)$/gm, '<h2>$1</h2>')
    .replace(/^# (.*)$/gm, '<h1>$1</h1>');

  // 4) bold / italic
  html = html
    .replace(/\*\*\*(.*?)\*\*\*/g, '<strong><em>$1</em></strong>')
    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
    .replace(/\*(.*?)\*/g, '<em>$1</em>');

  // 5) links
  html = html.replace(/\[([^\]]+)\]\(([^)]+)\)/g, '<a href="$2" target="_blank" rel="noopener">$1</a>');

  // 6) blockquotes
  html = html.replace(/^> (.*)$/gm, '<blockquote>$1</blockquote>');

  // 7) Lists ‚Äî unordered (-, *, +)
  html = html.replace(/(^(\s*[-*+]\s+.*(\r?\n|$))+)/gm, block => {
    const items = block.trim().split(/\r?\n/).filter(Boolean)
      .map(line => line.replace(/^\s*[-*+]\s+/, ''))
      .map(item => `<li>${item}</li>`).join('');
    return `<ul>${items}</ul>`;
  });

  // 8) Ordered lists (1., 2., ...)
  html = html.replace(/(^(\s*\d+\.\s+.*(\r?\n|$))+)/gm, block => {
    const items = block.trim().split(/\r?\n/).filter(Boolean)
      .map(line => line.replace(/^\s*\d+\.\s+/, ''))
      .map(item => `<li>${item}</li>`).join('');
    return `<ol>${items}</ol>`;
  });

  // 9) Paragraphs ‚Äî preserve existing block tags (h*, ul, ol, pre, blockquote)
  html = html
    .split(/\n{2,}/)
    .map(p => {
      p = p.trim();
      if(!p) return '';
      if(/^<(h\d|ul|ol|pre|blockquote)/.test(p)) return p;
      return `<p>${p.replace(/\n/g, '<br>')}</p>`;
    })
    .join('\n');

  return html;
}



    // ---------- Data loading ----------
    async function loadBlogPosts(){
      blogPosts = [];
      filteredPosts = [];
      allCategories = new Set();

      let rawPosts = null;
      try{
        const res = await fetch('data/blog.json',{cache:'no-store'});
        if(!res.ok) throw new Error('HTTP '+res.status);
        rawPosts = await res.json();
        if(!Array.isArray(rawPosts)) throw new Error('Blog data is not an array');
      }catch(err){
        console.warn('Falling back to inline posts. Reason:', err);
        rawPosts = FALLBACK_POSTS;
      }

      // Process each post
      for(let i=0;i<rawPosts.length;i++){
        const post = rawPosts[i] || {};
        const processed = {
          id: i+1,
          title: post.title || 'Untitled Post',
          category: (post.category || 'general').toLowerCase(),
          tags: Array.isArray(post.tags)?post.tags:[],
          date: post.date || new Date().toISOString().split('T')[0],
          readingTime: post.readingTime || 1,
          isExternal: !!post.externalUrl,
          externalUrl: post.externalUrl || null,
          content: '',
          excerpt: post.excerpt || '',
          __dateNum: parseDateValue(post.date)
        };

        allCategories.add(processed.category);

        if(post.externalUrl){
          processed.content = post.excerpt || 'Read the full post on the original site.';
          processed.excerpt = processed.excerpt || 'External blog post ‚Äî click to read more.';
        }else if(post.markdownFile){
          try{
            const mdRes = await fetch(`blog/${post.markdownFile}`,{cache:'no-store'});
            if(mdRes.ok){
              const md = await mdRes.text();
              processed.content = parseMarkdown(md);
              processed.excerpt = processed.excerpt || generateExcerpt(processed.content);
              processed.readingTime = calculateReadingTime(processed.content);
            }else{
              processed.content = '<p>Content not available.</p>';
            }
          }catch(e){
            console.warn('Failed to load markdown:', post.markdownFile, e);
            processed.content = '<p>Content not available.</p>';
          }
        }else if(post.markdown){
          try{
            const mdRes = await fetch(post.markdown, {cache:'no-store'});
            if(mdRes.ok){
              const md = await mdRes.text();
              processed.content = parseMarkdown(md);
              processed.excerpt = processed.excerpt || generateExcerpt(processed.content);
              processed.readingTime = calculateReadingTime(processed.content);
            }else{
              processed.content = '<p>Content not available.</p>';
            }
          }catch(e){
            console.warn('Failed to load markdown:', post.markdown, e);
            processed.content = '<p>Content not available.</p>';
          }
        }else if(post.content){
          processed.content = parseMarkdown(post.content);
          processed.excerpt = processed.excerpt || generateExcerpt(processed.content);
          processed.readingTime = calculateReadingTime(processed.content);
        }else{
          processed.content = '<p>No content available.</p>';
        }

        blogPosts.push(processed);
      }

      // Sort newest first
      blogPosts.sort((a,b)=>b.__dateNum - a.__dateNum);

      filteredPosts = [...blogPosts];
      updateStats();
      createFilterButtons();
      renderBlogPosts();
    }

    // ---------- UI builders ----------
    function createFilterButtons(){
      const wrap = document.getElementById('filter-buttons');

      // Remove existing category buttons (except "All")
      wrap.querySelectorAll('[data-filter]:not([data-filter="all"])').forEach(btn=>btn.remove());

      // Add category buttons from set
      [...allCategories].sort().forEach(cat=>{
        const btn = document.createElement('button');
        btn.className='filter-btn';
        btn.dataset.filter=cat;
        btn.textContent = cat.charAt(0).toUpperCase()+cat.slice(1);
        btn.addEventListener('click',()=>filterPosts(cat));
        wrap.appendChild(btn);
      });
    }

    function updateStats(){
      const totalReadTime = blogPosts.reduce((sum,p)=>sum+(p.readingTime||1),0);
      document.getElementById('total-posts').textContent = blogPosts.length;
      document.getElementById('total-categories').textContent = allCategories.size;
      document.getElementById('total-read-time').textContent = totalReadTime;
    }

    function renderBlogPosts(){
      const blogGrid = document.getElementById('blogGrid');
      const emptyState = document.getElementById('empty-state');

      if(filteredPosts.length===0){
        blogGrid.innerHTML='';
        emptyState.style.display='block';
        return;
      }
      emptyState.style.display='none';

      blogGrid.innerHTML = filteredPosts.map(post=>`
        <article class="post-card ${post.isExternal?'external':''}" data-category="${post.category}" data-post-id="${post.id}">
          <div class="post-meta">
            <span style="color:#666;font-size:0.85rem;font-weight:600;">${formatDate(post.date)}</span>
            <span style="color:#667eea;font-size:0.85rem;font-weight:600;text-transform:capitalize;">${escapeHtml(post.category)}</span>
          </div>
          <h3 class="post-title">${escapeHtml(post.title)}</h3>
          <p class="post-excerpt">${escapeHtml(post.excerpt)}</p>
          <div class="tags">
            ${post.tags.map(t=>`<span class="tag">${escapeHtml(t)}</span>`).join('')}
          </div>
          <div class="post-footer">
            <span class="read-time">${post.readingTime} min read</span>
            <button class="read-btn ${post.isExternal?'external':''}" onclick="handlePostClick(${post.id})">
              ${post.isExternal?'Read Original':'Read More'}
            </button>
          </div>
        </article>
      `).join('');

      setTimeout(animateCards, 80);
    }

    function animateCards(){
      const cards = document.querySelectorAll('.post-card');
      cards.forEach((card,i)=>{
        setTimeout(()=>card.classList.add('animate'), i*80);
      });
    }

    // ---------- Interactions ----------
    function filterPosts(category){
      currentFilter = category;
      document.querySelectorAll('.filter-btn').forEach(btn=>{
        btn.classList.toggle('active', btn.dataset.filter===category);
      });
      if(category==='all'){
        filteredPosts = [...blogPosts];
      }else{
        filteredPosts = blogPosts.filter(p=>p.category===category);
      }
      renderBlogPosts();
    }

    function searchPosts(query){
      const q = (query||'').toLowerCase().trim();
      if(!q){ filterPosts(currentFilter); return; }

      filteredPosts = blogPosts.filter(post=>{
        const inCat = currentFilter==='all' || post.category===currentFilter;
        const inText = post.title.toLowerCase().includes(q)
          || post.excerpt.toLowerCase().includes(q)
          || post.tags.some(t=>t.toLowerCase().includes(q))
          || post.content.toLowerCase().includes(q); // content is HTML but fine for basic search
        return inCat && inText;
      });
      renderBlogPosts();
    }

    function handlePostClick(postId){
      const post = blogPosts.find(p=>p.id===postId);
      if(!post) return;
      if(post.isExternal && post.externalUrl){
        window.open(post.externalUrl,'_blank','noopener,noreferrer');
      }else{
        openPostOverlay(postId);
      }
    }

    function openPostOverlay(postId){
      const post = blogPosts.find(p=>p.id===postId);
      if(!post) return;

      const overlay = document.getElementById('postOverlay');
      document.getElementById('overlayTitle').textContent = post.title;
      document.getElementById('overlayMeta').innerHTML = `
        <span>${formatDate(post.date)}</span>
        <span>‚Ä¢</span>
        <span>${post.readingTime} min read</span>
        <span>‚Ä¢</span>
        <span style="text-transform:capitalize;">${escapeHtml(post.category)}</span>
        <span>‚Ä¢</span>
        <span>By Gajendra Mandal</span>
      `;
      document.getElementById('overlayContent').innerHTML = post.content;

      const external = document.getElementById('overlayExternal');
      if(post.isExternal && post.externalUrl){
        external.style.display='block';
        external.innerHTML = `This post is also available on the <a href="${post.externalUrl}" target="_blank" rel="noopener">original platform</a>.`;
      }else{
        external.style.display='none';
      }

      overlay.style.display='flex';
      document.body.style.overflow='hidden';
    }

    function closePostOverlay(){
      document.getElementById('postOverlay').style.display='none';
      document.body.style.overflow='auto';
    }

    function setupEventListeners(){
      // Search (debounced)
      const searchInput = document.getElementById('blog-search');
      let t=null;
      searchInput.addEventListener('input',e=>{
        clearTimeout(t);
        t=setTimeout(()=>searchPosts(e.target.value),300);
      });

      // Close overlay
      document.getElementById('overlayClose').addEventListener('click', closePostOverlay);
      document.getElementById('postOverlay').addEventListener('click', e=>{
        if(e.target.id==='postOverlay'){ closePostOverlay(); }
      });
      document.addEventListener('keydown', e=>{
        if(e.key==='Escape') closePostOverlay();
      });

      // "All" filter button
      const allBtn = document.getElementById('filter-all');
      if(allBtn){
        allBtn.addEventListener('click',()=>filterPosts('all'));
      }
    }

    // ---------- Boot ----------
    document.addEventListener('DOMContentLoaded', async ()=>{
      setupEventListeners();
      await loadBlogPosts();
    });
  </script>
</body>
</html>
