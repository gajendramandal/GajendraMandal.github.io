<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Gallery — Gajendra Mandal</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    :root { --accent1: #667eea; --accent2: #764ba2; --muted:#666; --card-bg:#fff; }
    body{font-family:Inter,system-ui,Arial;margin:0;background:linear-gradient(135deg,var(--accent1),var(--accent2));color:#222}
    .container{max-width:1200px;margin:28px auto;padding:0 20px}
    /* White rounded panel that holds gallery (matches your site) */
    .panel{background:rgba(255,255,255,0.98);border-radius:20px;padding:28px;margin:18px 0;box-shadow:0 20px 40px rgba(0,0,0,0.12);border:1px solid rgba(255,255,255,0.25)}
    .panel h1{font-size:28px;text-align:center;margin:0 0 6px;background:linear-gradient(135deg,var(--accent1),var(--accent2));-webkit-background-clip:text;color:transparent;font-weight:800}
    .panel p.note{text-align:center;color:var(--muted);margin:6px 0 20px}

    /* Section styling for subtitles */
    .gallery-section{margin:32px 0 24px}
    .section-title{
      font-size:22px;
      font-weight:700;
      color:#333;
      margin:0 0 16px;
      padding:0 0 8px;
      border-bottom:2px solid var(--accent1);
      display:inline-block;
    }
    .section-subtitle{
      font-size:14px;
      color:var(--muted);
      margin:-8px 0 20px;
      font-weight:500;
    }

    /* grid */
    .grid{display:grid;gap:20px;grid-template-columns:repeat(auto-fit,minmax(450px,1fr));align-items:stretch}
    .card{background:var(--card-bg);border-radius:14px;overflow:hidden;box-shadow:0 10px 28px rgba(102,126,234,0.08);display:flex;flex-direction:column; width:450px; min-width:450px; max-width:450px; height:450px; min-height:450px; max-height:450px; margin:auto;}
    .card-figure{position:relative;overflow:hidden;width:100%;height:320px;background:#f6f7fb;display:flex;align-items:center;justify-content:center;}
    .card-figure img{width:100%;height:100%;object-fit:contain;display:block;transition:transform .45s ease;background:#f6f7fb;}
    .card:hover .card-figure img{transform:scale(1.03)}
    
    /* circular badge overlapping image (center-bottom) */
    .badge{
      position:absolute;
      left:50%;
      transform:translateX(-50%);
      bottom:28px;
      background:rgba(255,255,255,0.98);
      padding:10px 18px;
      border-radius:999px;
      box-shadow:0 8px 24px rgba(102,126,234,0.12);
      font-weight:700;color:var(--accent1);font-size:0.95rem;
      display:inline-block;
    }
    /* title pill overlapping the very bottom of image, full-width slightly inset */
    .title-pill{
      position:absolute;
      left:12px; right:12px;
      bottom:8px;
      background:rgba(255,255,255,0.95);
      border-radius:999px;
      padding:10px 14px;
      text-align:center;
      font-weight:800;color:var(--accent2);
      box-shadow:0 6px 18px rgba(0,0,0,0.08);
      font-size:0.95rem;
      white-space:nowrap;
      overflow:hidden;text-overflow:ellipsis;
    }
    .card-body{padding:14px 16px 22px;text-align:center;flex:1;display:flex;flex-direction:column;justify-content:flex-start}
    .card-title{font-weight:700;margin:6px 0 8px;color:#111; font-size:1.03rem}
    .card-date{color:var(--accent1);font-weight:600;margin-bottom:10px;font-size:0.9rem}
    .card-desc{color:var(--muted);line-height:1.55;font-size:0.95rem;margin:0;flex:0}

    /* responsive tweaks */
    @media (max-width:900px){ 
      .card-figure{height:250px} 
      .card{width:100%;min-width:0;max-width:100%;height:auto;min-height:0;max-height:none;} 
      .section-title{font-size:20px}
    }
    @media (max-width:520px){ 
      .card-figure{height:180px} 
      .badge{bottom:18px;font-size:0.9rem} 
      .title-pill{font-size:0.9rem} 
      .card{width:100%;min-width:0;max-width:100%;height:auto;min-height:0;max-height:none;} 
      .section-title{font-size:18px}
      .container{padding:0 15px}
    }
  </style>
</head>
<body>
  <!-- header (keeps simple, use your existing header if you have one) -->
  <header style="background:rgba(30,34,45,0.85);backdrop-filter:blur(8px);position:sticky;top:0;z-index:100;">
    <nav class="container" style="display:flex;justify-content:space-between;align-items:center;padding:12px 0;">
      <a href="index.html#home" style="color:white;font-weight:700;font-size:1.2rem;text-decoration:none">Gajendra Mandal</a>
      <ul style="display:flex;gap:14px;list-style:none;margin:0;padding:0;color:white;font-weight:600;">
        <li><a href="index.html#home" style="color:white;text-decoration:none">Home</a></li>
        <li><a href="skill.html" style="color:white;text-decoration:none">Skills</a></li>
        <li><a href="projects.html" style="color:white;text-decoration:none">Projects</a></li>
        <li><a href="publications.html" style="color:white;text-decoration:none">Publications</a></li>
        <li><a href="blogposts.html" style="color:white;text-decoration:none">Blogposts</a></li>
        <li><a href="gallery.html" style="color:white;text-decoration:none">Gallery</a></li>
      </ul>
    </nav>
  </header>

  <main class="container">
    <div class="panel" role="region" aria-labelledby="gallery-title">
      <h1 id="gallery-title">Gallery</h1>
  <p style="text-align:center;color:var(--muted);margin:10px 0 24px;font-size:1.08rem;">Welcome to my gallery! Here you'll find a collection of images from my life, including memorable moments and photos I've taken. I'll continue to add more images as I capture new experiences and milestones along my journey.</p>
      <div id="gallery-content" aria-live="polite"></div>
    </div>
  </main>

  <footer style="background:rgba(0,0,0,0.8);color:white;text-align:center;padding:18px;margin-top:18px">
    <div class="container"><p>&copy; 2025 Gajendra Mandal. All rights reserved.</p></div>
  </footer>

<script>
/*
  Enhanced renderer:
   - loads docs/data/gallery.json
   - normalizes image paths (removes leading slash)
   - groups by category/event
   - sorts by date desc within each group
   - renders with section headers and organized layout
*/
const PLACEHOLDER = 'data:image/svg+xml;utf8,' + encodeURIComponent(
  '<svg xmlns="http://www.w3.org/2000/svg" width="1600" height="1000"><rect width="100%" height="100%" fill="#f6f7fb"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" fill="#cbd5e1" font-family="Arial" font-size="36">Image missing</text></svg>'
);

function normalizePath(p){
  if(!p) return '';
  p = String(p).trim();
  if(p.startsWith('/')) p = p.slice(1);
  return p;
}
function parseDateValue(d){ const t = Date.parse(d); return isNaN(t) ? 0 : t; }
function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g,c=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }

async function loadGallery(){
  try{
    const res = await fetch('data/gallery.json', {cache:'no-store'});
    if(!res.ok) throw new Error('Failed to load data/gallery.json: ' + res.status);
    let rawData = await res.json();
    if(!Array.isArray(rawData)) rawData = [];

    // Process items - handle both single images and image arrays
    let items = [];
    rawData.forEach((entry, idx) => {
      if(entry.images && Array.isArray(entry.images)) {
        // Multiple images in one entry
        entry.images.forEach((imgData, imgIdx) => {
          items.push({
            image: normalizePath(imgData.image || ''),
            title: imgData.title || entry.title || '',
            date: entry.date || '',
            badge: imgData.badge || entry.badge || '',
            description: imgData.description || entry.description || '',
            category: entry.category || 'Miscellaneous',
            location: entry.location || '',
            __idx: idx * 1000 + imgIdx, // Ensure proper ordering
            __dateNum: parseDateValue(entry.date)
          });
        });
      } else {
        // Single image entry (backward compatibility)
        items.push({
          image: normalizePath(entry.image || ''),
          title: entry.title || '',
          date: entry.date || '',
          badge: entry.badge || '',
          description: entry.description || '',
          category: entry.category || 'Miscellaneous',
          location: entry.location || '',
          __idx: idx,
          __dateNum: parseDateValue(entry.date)
        });
      }
    });

    // Group by category
    const grouped = {};
    items.forEach(item => {
      const cat = item.category;
      if(!grouped[cat]) grouped[cat] = [];
      grouped[cat].push(item);
    });

    // Sort each group by date (newest first)
    Object.keys(grouped).forEach(cat => {
      grouped[cat].sort((a,b) => {
        if(b.__dateNum !== a.__dateNum) return b.__dateNum - a.__dateNum;
        return b.__idx - a.__idx;
      });
    });

    renderGroupedGallery(grouped);

    // pre-load images and replace missing with placeholder (non-blocking)
    items.forEach(it => {
      if(!it.image){ it._img = PLACEHOLDER; return; }
      const img = new Image();
      img.onload = () => { it._img = it.image; document.querySelectorAll('img[data-src="'+it.image+'"]').forEach(el=>el.src = it.image); };
      img.onerror = () => { it._img = PLACEHOLDER; console.warn('Missing gallery image:', it.image); document.querySelectorAll('img[data-src="'+it.image+'"]').forEach(el=>el.src = PLACEHOLDER); };
      img.src = it.image;
    });

  }catch(err){
    console.error(err);
    document.getElementById('gallery-content').innerHTML = '<p style="color:#666">Could not load gallery data. Make sure <code>docs/data/gallery.json</code> exists and is valid JSON.</p>';
  }
}

function renderGroupedGallery(grouped){
  const container = document.getElementById('gallery-content');
  container.innerHTML = '';
  
  const categories = Object.keys(grouped);
  if(categories.length === 0){
    container.innerHTML = '<p style="color:#666">No memories yet — add images to <code>docs/images/gallery/</code> and entries to <code>docs/data/gallery.json</code>.</p>';
    return;
  }

  // Sort categories by the latest date in each category
  categories.sort((a, b) => {
    const aLatest = Math.max(...grouped[a].map(item => item.__dateNum));
    const bLatest = Math.max(...grouped[b].map(item => item.__dateNum));
    return bLatest - aLatest;
  });

  categories.forEach(category => {
    const items = grouped[category];
    if(items.length === 0) return;

    // Create section
    const section = document.createElement('section');
    section.className = 'gallery-section';
    
    // Create section header
    const sectionHeader = document.createElement('div');
    sectionHeader.innerHTML = `
      <h2 class="section-title">${escapeHtml(category)}</h2>
      ${items[0].location ? `<p class="section-subtitle">${escapeHtml(items[0].location)}</p>` : ''}
    `;
    section.appendChild(sectionHeader);

    // Create grid for this section
    const grid = document.createElement('div');
    grid.className = 'grid';
    
    items.forEach(it => {
      const el = document.createElement('article');
      el.className = 'card';
      const imgSrc = it.image ? escapeHtml(it.image) : PLACEHOLDER;
      el.innerHTML = `
        <div class="card-figure">
          <img data-src="${imgSrc}" src="${PLACEHOLDER}" alt="${escapeHtml(it.title)}">
        </div>
        <div class="card-body">
          <h3 class="card-title">${escapeHtml(it.title)}</h3>
          <p class="card-desc">${escapeHtml(it.description)}</p>
        </div>
      `;
      grid.appendChild(el);
    });
    
    section.appendChild(grid);
    container.appendChild(section);
  });
}

// start
loadGallery();
</script>
</body>
</html>
